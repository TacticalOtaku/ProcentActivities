# ProcentActivities

Модуль для Foundry VTT, который добавляет возможность наносить урон или исцелять на основе процента от текущих или максимальных хитов (HP) цели. Поддерживает интеграцию с D&D 5e, Midi QOL и Dynamic Active Effects (DAE). Включает удобный интерфейс для настройки процентных эффектов на предметах (оружие, заклинания и т.д.).

## Основные возможности
- Настройка урона или исцеления в процентах от текущих или максимальных HP цели.
- Графический интерфейс для конфигурации эффектов на предметах.
- Совместимость с Midi QOL для автоматического применения урона через чат-карты.
- Поддержка активных эффектов через DAE для автоматизации.

## Установка
1. Откройте Foundry VTT и перейдите в **Настройки игры → Дополнения → Установить модуль**.
2. В поле **URL манифеста** вставьте:
   ```
   https://github.com/TacticalOtaku/ProcentActivities/blob/main/module.json
   ```
3. Нажмите **Установить**.
4. После установки активируйте модуль в настройках вашего игрового мира (**Настройки игры → Управление модулями**).

## Зависимости
Для работы модуля требуются следующие компоненты:
- **D&D 5e**: Версия 4.2.0 или выше (проверено на 4.2.2).
- **Midi QOL**: Версия 12.4.27 или выше (проверено на 12.4.43).
- **Dynamic Active Effects (DAE)**: Версия 12.0.12.

Убедитесь, что эти модули установлены и активированы в вашем мире.

## Использование
Модуль добавляет кнопку **"Percent Config"** в листы предметов (оружие, заклинания, снаряжение и т.д.), позволяя настроить процентные эффекты.

### Настройка предмета
1. Откройте лист предмета (например, "Меч" или "Огненный шар").
2. Нажмите кнопку **"Percent Config"** (иконка с процентом).
3. В открывшейся форме настройте:
   - **HP Base**: Основа для расчёта — текущие HP цели (`Current HP`) или максимальные HP (`Maximum HP`).
   - **Action Type**: Тип действия — урон (`Damage`) или исцеление (`Healing`).
   - **Percentage (%)**: Процент от выбранной основы (например, 75 для 75% урона).
   - **Allow Overlimit**: Разрешить проценты выше 100% (по умолчанию выключено).
4. Сохраните настройки.

### Пример 1: Урон 75% от текущих HP
- **Предмет**: Меч ("Test Sword").
- **Настройки**:
  - HP Base: Current HP.
  - Action Type: Damage.
  - Percentage: 75.
  - Allow Overlimit: Выключено.
- **Ситуация**: Актёр NONDIMAS имеет 25 текущих HP.
- **Результат**: При атаке через Midi QOL наносится 19 урона (`Math.round((25 * 75) / 100) = 19`).
- **Лог в консоли**:
  ```
  ProcentActivities: Calculating damage for NONDIMAS. BaseHP: 25, Percentage: 75, Amount: 19
  ProcentActivities: Applied 19 damage to NONDIMAS
  ```

### Пример 2: Исцеление 50% от максимальных HP
- **Предмет**: Заклинание "Лечение ран".
- **Настройки**:
  - HP Base: Maximum HP.
  - Action Type: Healing.
  - Percentage: 50.
  - Allow Overlimit: Выключено.
- **Ситуация**: Актёр имеет 10 текущих HP и 20 максимальных HP.
- **Результат**: При использовании заклинания восстанавливается 10 HP (`Math.round((20 * 50) / 100) = 10`), итоговые HP: 20.
- **Лог в консоли**:
  ```
  ProcentActivities: Calculating healing for <имя_актёра>. BaseHP: 20, Percentage: 50, Amount: 10
  ProcentActivities: Applying healing to <имя_актёра>. CurrentHP: 10, NewHP: 20
  ```

### Тестирование
1. Создайте предмет (например, оружие "Test Sword").
2. Настройте процентный эффект (например, 75% урона от текущих HP).
3. Создайте актёра с 25 текущими HP.
4. Атакуйте через чат-карту Midi QOL.
5. Проверьте урон (должен быть 19) и логи в консоли (F12 → Console).

## Совместимость
- **Foundry VTT**: Версия 12 (проверено на 12.331).
- **Система**: D&D 5e.
- **Модули**: Midi QOL, Dynamic Active Effects.

## Устранение неполадок
- **Модуль не работает**: Убедитесь, что Midi QOL и DAE активированы, а предмет настроен для вызова чат-карты Midi QOL (Action Type: Attack).
- **Неверный урон**: Проверьте флаги предмета в консоли:
  ```javascript
  game.items.getName("Test Sword").getFlag("procent-activities", "config")
  ```
  Ожидаемый вывод: `{ hpBase: "current", actionType: "damage", percentage: 75, allowOverlimit: false }`.
- **Нет логов**: Откройте консоль браузера (F12) и проверьте сообщения `ProcentActivities`.


## Лицензия
MIT License. Модуль распространяется бесплатно для личного и коммерческого использования.